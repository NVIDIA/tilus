# SPDX-FileCopyrightText: Copyright (c) 2025 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
# SPDX-License-Identifier: Apache-2.0
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
import pytest
from hidet.ir.dtypes import float16, float32
from tilus.ir.layout.cuda.tcgen05.smem import (
    CanonicalSharedLayout,
    Tcgen05SwizzleMode,
    canonicalize_shared_layout,
    get_shared_layout_from_canonical,
)

canonical2expected = [
    [
        CanonicalSharedLayout(
            major_kind="MN", swizzle_mode=Tcgen05SwizzleMode.NO_SWIZZLE, SBO=64, LBO=128, m=2, k=2, T=8
        ),
        """
┌────┬────┬────┬────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┐
│  0 │  8 │ 16 │ 24 │  32 │  40 │  48 │  56 │ 128 │ 136 │ 144 │ 152 │ 160 │ 168 │ 176 │ 184 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  1 │  9 │ 17 │ 25 │  33 │  41 │  49 │  57 │ 129 │ 137 │ 145 │ 153 │ 161 │ 169 │ 177 │ 185 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  2 │ 10 │ 18 │ 26 │  34 │  42 │  50 │  58 │ 130 │ 138 │ 146 │ 154 │ 162 │ 170 │ 178 │ 186 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  3 │ 11 │ 19 │ 27 │  35 │  43 │  51 │  59 │ 131 │ 139 │ 147 │ 155 │ 163 │ 171 │ 179 │ 187 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  4 │ 12 │ 20 │ 28 │  36 │  44 │  52 │  60 │ 132 │ 140 │ 148 │ 156 │ 164 │ 172 │ 180 │ 188 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  5 │ 13 │ 21 │ 29 │  37 │  45 │  53 │  61 │ 133 │ 141 │ 149 │ 157 │ 165 │ 173 │ 181 │ 189 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  6 │ 14 │ 22 │ 30 │  38 │  46 │  54 │  62 │ 134 │ 142 │ 150 │ 158 │ 166 │ 174 │ 182 │ 190 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  7 │ 15 │ 23 │ 31 │  39 │  47 │  55 │  63 │ 135 │ 143 │ 151 │ 159 │ 167 │ 175 │ 183 │ 191 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 64 │ 72 │ 80 │ 88 │  96 │ 104 │ 112 │ 120 │ 192 │ 200 │ 208 │ 216 │ 224 │ 232 │ 240 │ 248 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 65 │ 73 │ 81 │ 89 │  97 │ 105 │ 113 │ 121 │ 193 │ 201 │ 209 │ 217 │ 225 │ 233 │ 241 │ 249 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 66 │ 74 │ 82 │ 90 │  98 │ 106 │ 114 │ 122 │ 194 │ 202 │ 210 │ 218 │ 226 │ 234 │ 242 │ 250 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 67 │ 75 │ 83 │ 91 │  99 │ 107 │ 115 │ 123 │ 195 │ 203 │ 211 │ 219 │ 227 │ 235 │ 243 │ 251 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 68 │ 76 │ 84 │ 92 │ 100 │ 108 │ 116 │ 124 │ 196 │ 204 │ 212 │ 220 │ 228 │ 236 │ 244 │ 252 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 69 │ 77 │ 85 │ 93 │ 101 │ 109 │ 117 │ 125 │ 197 │ 205 │ 213 │ 221 │ 229 │ 237 │ 245 │ 253 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 70 │ 78 │ 86 │ 94 │ 102 │ 110 │ 118 │ 126 │ 198 │ 206 │ 214 │ 222 │ 230 │ 238 │ 246 │ 254 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 71 │ 79 │ 87 │ 95 │ 103 │ 111 │ 119 │ 127 │ 199 │ 207 │ 215 │ 223 │ 231 │ 239 │ 247 │ 255 │
└────┴────┴────┴────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┘
    """,
    ],
    [
        CanonicalSharedLayout(
            major_kind="MN", swizzle_mode=Tcgen05SwizzleMode.B32_SWIZZLE, SBO=256, LBO=128, m=2, k=2, T=8
        ),
        """
┌─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┐
│   0 │  16 │  32 │  48 │  72 │  88 │ 104 │ 120 │ 256 │ 272 │ 288 │ 304 │ 328 │ 344 │ 360 │ 376 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│   1 │  17 │  33 │  49 │  73 │  89 │ 105 │ 121 │ 257 │ 273 │ 289 │ 305 │ 329 │ 345 │ 361 │ 377 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│   2 │  18 │  34 │  50 │  74 │  90 │ 106 │ 122 │ 258 │ 274 │ 290 │ 306 │ 330 │ 346 │ 362 │ 378 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│   3 │  19 │  35 │  51 │  75 │  91 │ 107 │ 123 │ 259 │ 275 │ 291 │ 307 │ 331 │ 347 │ 363 │ 379 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│   4 │  20 │  36 │  52 │  76 │  92 │ 108 │ 124 │ 260 │ 276 │ 292 │ 308 │ 332 │ 348 │ 364 │ 380 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│   5 │  21 │  37 │  53 │  77 │  93 │ 109 │ 125 │ 261 │ 277 │ 293 │ 309 │ 333 │ 349 │ 365 │ 381 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│   6 │  22 │  38 │  54 │  78 │  94 │ 110 │ 126 │ 262 │ 278 │ 294 │ 310 │ 334 │ 350 │ 366 │ 382 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│   7 │  23 │  39 │  55 │  79 │  95 │ 111 │ 127 │ 263 │ 279 │ 295 │ 311 │ 335 │ 351 │ 367 │ 383 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│   8 │  24 │  40 │  56 │  64 │  80 │  96 │ 112 │ 264 │ 280 │ 296 │ 312 │ 320 │ 336 │ 352 │ 368 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│   9 │  25 │  41 │  57 │  65 │  81 │  97 │ 113 │ 265 │ 281 │ 297 │ 313 │ 321 │ 337 │ 353 │ 369 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  10 │  26 │  42 │  58 │  66 │  82 │  98 │ 114 │ 266 │ 282 │ 298 │ 314 │ 322 │ 338 │ 354 │ 370 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  11 │  27 │  43 │  59 │  67 │  83 │  99 │ 115 │ 267 │ 283 │ 299 │ 315 │ 323 │ 339 │ 355 │ 371 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  12 │  28 │  44 │  60 │  68 │  84 │ 100 │ 116 │ 268 │ 284 │ 300 │ 316 │ 324 │ 340 │ 356 │ 372 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  13 │  29 │  45 │  61 │  69 │  85 │ 101 │ 117 │ 269 │ 285 │ 301 │ 317 │ 325 │ 341 │ 357 │ 373 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  14 │  30 │  46 │  62 │  70 │  86 │ 102 │ 118 │ 270 │ 286 │ 302 │ 318 │ 326 │ 342 │ 358 │ 374 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  15 │  31 │  47 │  63 │  71 │  87 │ 103 │ 119 │ 271 │ 287 │ 303 │ 319 │ 327 │ 343 │ 359 │ 375 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 128 │ 144 │ 160 │ 176 │ 200 │ 216 │ 232 │ 248 │ 384 │ 400 │ 416 │ 432 │ 456 │ 472 │ 488 │ 504 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 129 │ 145 │ 161 │ 177 │ 201 │ 217 │ 233 │ 249 │ 385 │ 401 │ 417 │ 433 │ 457 │ 473 │ 489 │ 505 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 130 │ 146 │ 162 │ 178 │ 202 │ 218 │ 234 │ 250 │ 386 │ 402 │ 418 │ 434 │ 458 │ 474 │ 490 │ 506 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 131 │ 147 │ 163 │ 179 │ 203 │ 219 │ 235 │ 251 │ 387 │ 403 │ 419 │ 435 │ 459 │ 475 │ 491 │ 507 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 132 │ 148 │ 164 │ 180 │ 204 │ 220 │ 236 │ 252 │ 388 │ 404 │ 420 │ 436 │ 460 │ 476 │ 492 │ 508 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 133 │ 149 │ 165 │ 181 │ 205 │ 221 │ 237 │ 253 │ 389 │ 405 │ 421 │ 437 │ 461 │ 477 │ 493 │ 509 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 134 │ 150 │ 166 │ 182 │ 206 │ 222 │ 238 │ 254 │ 390 │ 406 │ 422 │ 438 │ 462 │ 478 │ 494 │ 510 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 135 │ 151 │ 167 │ 183 │ 207 │ 223 │ 239 │ 255 │ 391 │ 407 │ 423 │ 439 │ 463 │ 479 │ 495 │ 511 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 136 │ 152 │ 168 │ 184 │ 192 │ 208 │ 224 │ 240 │ 392 │ 408 │ 424 │ 440 │ 448 │ 464 │ 480 │ 496 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 137 │ 153 │ 169 │ 185 │ 193 │ 209 │ 225 │ 241 │ 393 │ 409 │ 425 │ 441 │ 449 │ 465 │ 481 │ 497 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 138 │ 154 │ 170 │ 186 │ 194 │ 210 │ 226 │ 242 │ 394 │ 410 │ 426 │ 442 │ 450 │ 466 │ 482 │ 498 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 139 │ 155 │ 171 │ 187 │ 195 │ 211 │ 227 │ 243 │ 395 │ 411 │ 427 │ 443 │ 451 │ 467 │ 483 │ 499 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 140 │ 156 │ 172 │ 188 │ 196 │ 212 │ 228 │ 244 │ 396 │ 412 │ 428 │ 444 │ 452 │ 468 │ 484 │ 500 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 141 │ 157 │ 173 │ 189 │ 197 │ 213 │ 229 │ 245 │ 397 │ 413 │ 429 │ 445 │ 453 │ 469 │ 485 │ 501 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 142 │ 158 │ 174 │ 190 │ 198 │ 214 │ 230 │ 246 │ 398 │ 414 │ 430 │ 446 │ 454 │ 470 │ 486 │ 502 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 143 │ 159 │ 175 │ 191 │ 199 │ 215 │ 231 │ 247 │ 399 │ 415 │ 431 │ 447 │ 455 │ 471 │ 487 │ 503 │
└─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┘
    """,
    ],
    [
        CanonicalSharedLayout(
            major_kind="MN", swizzle_mode=Tcgen05SwizzleMode.B64_SWIZZLE, SBO=512, LBO=256, m=2, k=2, T=8
        ),
        """
┌─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬──────┐
│   0 │  32 │  72 │ 104 │ 144 │ 176 │ 216 │ 248 │ 512 │ 544 │ 584 │ 616 │ 656 │ 688 │ 728 │  760 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│   1 │  33 │  73 │ 105 │ 145 │ 177 │ 217 │ 249 │ 513 │ 545 │ 585 │ 617 │ 657 │ 689 │ 729 │  761 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│   2 │  34 │  74 │ 106 │ 146 │ 178 │ 218 │ 250 │ 514 │ 546 │ 586 │ 618 │ 658 │ 690 │ 730 │  762 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│   3 │  35 │  75 │ 107 │ 147 │ 179 │ 219 │ 251 │ 515 │ 547 │ 587 │ 619 │ 659 │ 691 │ 731 │  763 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│   4 │  36 │  76 │ 108 │ 148 │ 180 │ 220 │ 252 │ 516 │ 548 │ 588 │ 620 │ 660 │ 692 │ 732 │  764 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│   5 │  37 │  77 │ 109 │ 149 │ 181 │ 221 │ 253 │ 517 │ 549 │ 589 │ 621 │ 661 │ 693 │ 733 │  765 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│   6 │  38 │  78 │ 110 │ 150 │ 182 │ 222 │ 254 │ 518 │ 550 │ 590 │ 622 │ 662 │ 694 │ 734 │  766 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│   7 │  39 │  79 │ 111 │ 151 │ 183 │ 223 │ 255 │ 519 │ 551 │ 591 │ 623 │ 663 │ 695 │ 735 │  767 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│   8 │  40 │  64 │  96 │ 152 │ 184 │ 208 │ 240 │ 520 │ 552 │ 576 │ 608 │ 664 │ 696 │ 720 │  752 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│   9 │  41 │  65 │  97 │ 153 │ 185 │ 209 │ 241 │ 521 │ 553 │ 577 │ 609 │ 665 │ 697 │ 721 │  753 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│  10 │  42 │  66 │  98 │ 154 │ 186 │ 210 │ 242 │ 522 │ 554 │ 578 │ 610 │ 666 │ 698 │ 722 │  754 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│  11 │  43 │  67 │  99 │ 155 │ 187 │ 211 │ 243 │ 523 │ 555 │ 579 │ 611 │ 667 │ 699 │ 723 │  755 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│  12 │  44 │  68 │ 100 │ 156 │ 188 │ 212 │ 244 │ 524 │ 556 │ 580 │ 612 │ 668 │ 700 │ 724 │  756 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│  13 │  45 │  69 │ 101 │ 157 │ 189 │ 213 │ 245 │ 525 │ 557 │ 581 │ 613 │ 669 │ 701 │ 725 │  757 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│  14 │  46 │  70 │ 102 │ 158 │ 190 │ 214 │ 246 │ 526 │ 558 │ 582 │ 614 │ 670 │ 702 │ 726 │  758 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│  15 │  47 │  71 │ 103 │ 159 │ 191 │ 215 │ 247 │ 527 │ 559 │ 583 │ 615 │ 671 │ 703 │ 727 │  759 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│  16 │  48 │  88 │ 120 │ 128 │ 160 │ 200 │ 232 │ 528 │ 560 │ 600 │ 632 │ 640 │ 672 │ 712 │  744 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│  17 │  49 │  89 │ 121 │ 129 │ 161 │ 201 │ 233 │ 529 │ 561 │ 601 │ 633 │ 641 │ 673 │ 713 │  745 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│  18 │  50 │  90 │ 122 │ 130 │ 162 │ 202 │ 234 │ 530 │ 562 │ 602 │ 634 │ 642 │ 674 │ 714 │  746 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│  19 │  51 │  91 │ 123 │ 131 │ 163 │ 203 │ 235 │ 531 │ 563 │ 603 │ 635 │ 643 │ 675 │ 715 │  747 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│  20 │  52 │  92 │ 124 │ 132 │ 164 │ 204 │ 236 │ 532 │ 564 │ 604 │ 636 │ 644 │ 676 │ 716 │  748 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│  21 │  53 │  93 │ 125 │ 133 │ 165 │ 205 │ 237 │ 533 │ 565 │ 605 │ 637 │ 645 │ 677 │ 717 │  749 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│  22 │  54 │  94 │ 126 │ 134 │ 166 │ 206 │ 238 │ 534 │ 566 │ 606 │ 638 │ 646 │ 678 │ 718 │  750 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│  23 │  55 │  95 │ 127 │ 135 │ 167 │ 207 │ 239 │ 535 │ 567 │ 607 │ 639 │ 647 │ 679 │ 719 │  751 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│  24 │  56 │  80 │ 112 │ 136 │ 168 │ 192 │ 224 │ 536 │ 568 │ 592 │ 624 │ 648 │ 680 │ 704 │  736 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│  25 │  57 │  81 │ 113 │ 137 │ 169 │ 193 │ 225 │ 537 │ 569 │ 593 │ 625 │ 649 │ 681 │ 705 │  737 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│  26 │  58 │  82 │ 114 │ 138 │ 170 │ 194 │ 226 │ 538 │ 570 │ 594 │ 626 │ 650 │ 682 │ 706 │  738 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│  27 │  59 │  83 │ 115 │ 139 │ 171 │ 195 │ 227 │ 539 │ 571 │ 595 │ 627 │ 651 │ 683 │ 707 │  739 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│  28 │  60 │  84 │ 116 │ 140 │ 172 │ 196 │ 228 │ 540 │ 572 │ 596 │ 628 │ 652 │ 684 │ 708 │  740 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│  29 │  61 │  85 │ 117 │ 141 │ 173 │ 197 │ 229 │ 541 │ 573 │ 597 │ 629 │ 653 │ 685 │ 709 │  741 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│  30 │  62 │  86 │ 118 │ 142 │ 174 │ 198 │ 230 │ 542 │ 574 │ 598 │ 630 │ 654 │ 686 │ 710 │  742 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│  31 │  63 │  87 │ 119 │ 143 │ 175 │ 199 │ 231 │ 543 │ 575 │ 599 │ 631 │ 655 │ 687 │ 711 │  743 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 256 │ 288 │ 328 │ 360 │ 400 │ 432 │ 472 │ 504 │ 768 │ 800 │ 840 │ 872 │ 912 │ 944 │ 984 │ 1016 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 257 │ 289 │ 329 │ 361 │ 401 │ 433 │ 473 │ 505 │ 769 │ 801 │ 841 │ 873 │ 913 │ 945 │ 985 │ 1017 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 258 │ 290 │ 330 │ 362 │ 402 │ 434 │ 474 │ 506 │ 770 │ 802 │ 842 │ 874 │ 914 │ 946 │ 986 │ 1018 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 259 │ 291 │ 331 │ 363 │ 403 │ 435 │ 475 │ 507 │ 771 │ 803 │ 843 │ 875 │ 915 │ 947 │ 987 │ 1019 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 260 │ 292 │ 332 │ 364 │ 404 │ 436 │ 476 │ 508 │ 772 │ 804 │ 844 │ 876 │ 916 │ 948 │ 988 │ 1020 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 261 │ 293 │ 333 │ 365 │ 405 │ 437 │ 477 │ 509 │ 773 │ 805 │ 845 │ 877 │ 917 │ 949 │ 989 │ 1021 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 262 │ 294 │ 334 │ 366 │ 406 │ 438 │ 478 │ 510 │ 774 │ 806 │ 846 │ 878 │ 918 │ 950 │ 990 │ 1022 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 263 │ 295 │ 335 │ 367 │ 407 │ 439 │ 479 │ 511 │ 775 │ 807 │ 847 │ 879 │ 919 │ 951 │ 991 │ 1023 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 264 │ 296 │ 320 │ 352 │ 408 │ 440 │ 464 │ 496 │ 776 │ 808 │ 832 │ 864 │ 920 │ 952 │ 976 │ 1008 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 265 │ 297 │ 321 │ 353 │ 409 │ 441 │ 465 │ 497 │ 777 │ 809 │ 833 │ 865 │ 921 │ 953 │ 977 │ 1009 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 266 │ 298 │ 322 │ 354 │ 410 │ 442 │ 466 │ 498 │ 778 │ 810 │ 834 │ 866 │ 922 │ 954 │ 978 │ 1010 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 267 │ 299 │ 323 │ 355 │ 411 │ 443 │ 467 │ 499 │ 779 │ 811 │ 835 │ 867 │ 923 │ 955 │ 979 │ 1011 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 268 │ 300 │ 324 │ 356 │ 412 │ 444 │ 468 │ 500 │ 780 │ 812 │ 836 │ 868 │ 924 │ 956 │ 980 │ 1012 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 269 │ 301 │ 325 │ 357 │ 413 │ 445 │ 469 │ 501 │ 781 │ 813 │ 837 │ 869 │ 925 │ 957 │ 981 │ 1013 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 270 │ 302 │ 326 │ 358 │ 414 │ 446 │ 470 │ 502 │ 782 │ 814 │ 838 │ 870 │ 926 │ 958 │ 982 │ 1014 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 271 │ 303 │ 327 │ 359 │ 415 │ 447 │ 471 │ 503 │ 783 │ 815 │ 839 │ 871 │ 927 │ 959 │ 983 │ 1015 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 272 │ 304 │ 344 │ 376 │ 384 │ 416 │ 456 │ 488 │ 784 │ 816 │ 856 │ 888 │ 896 │ 928 │ 968 │ 1000 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 273 │ 305 │ 345 │ 377 │ 385 │ 417 │ 457 │ 489 │ 785 │ 817 │ 857 │ 889 │ 897 │ 929 │ 969 │ 1001 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 274 │ 306 │ 346 │ 378 │ 386 │ 418 │ 458 │ 490 │ 786 │ 818 │ 858 │ 890 │ 898 │ 930 │ 970 │ 1002 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 275 │ 307 │ 347 │ 379 │ 387 │ 419 │ 459 │ 491 │ 787 │ 819 │ 859 │ 891 │ 899 │ 931 │ 971 │ 1003 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 276 │ 308 │ 348 │ 380 │ 388 │ 420 │ 460 │ 492 │ 788 │ 820 │ 860 │ 892 │ 900 │ 932 │ 972 │ 1004 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 277 │ 309 │ 349 │ 381 │ 389 │ 421 │ 461 │ 493 │ 789 │ 821 │ 861 │ 893 │ 901 │ 933 │ 973 │ 1005 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 278 │ 310 │ 350 │ 382 │ 390 │ 422 │ 462 │ 494 │ 790 │ 822 │ 862 │ 894 │ 902 │ 934 │ 974 │ 1006 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 279 │ 311 │ 351 │ 383 │ 391 │ 423 │ 463 │ 495 │ 791 │ 823 │ 863 │ 895 │ 903 │ 935 │ 975 │ 1007 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 280 │ 312 │ 336 │ 368 │ 392 │ 424 │ 448 │ 480 │ 792 │ 824 │ 848 │ 880 │ 904 │ 936 │ 960 │  992 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 281 │ 313 │ 337 │ 369 │ 393 │ 425 │ 449 │ 481 │ 793 │ 825 │ 849 │ 881 │ 905 │ 937 │ 961 │  993 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 282 │ 314 │ 338 │ 370 │ 394 │ 426 │ 450 │ 482 │ 794 │ 826 │ 850 │ 882 │ 906 │ 938 │ 962 │  994 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 283 │ 315 │ 339 │ 371 │ 395 │ 427 │ 451 │ 483 │ 795 │ 827 │ 851 │ 883 │ 907 │ 939 │ 963 │  995 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 284 │ 316 │ 340 │ 372 │ 396 │ 428 │ 452 │ 484 │ 796 │ 828 │ 852 │ 884 │ 908 │ 940 │ 964 │  996 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 285 │ 317 │ 341 │ 373 │ 397 │ 429 │ 453 │ 485 │ 797 │ 829 │ 853 │ 885 │ 909 │ 941 │ 965 │  997 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 286 │ 318 │ 342 │ 374 │ 398 │ 430 │ 454 │ 486 │ 798 │ 830 │ 854 │ 886 │ 910 │ 942 │ 966 │  998 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼──────┤
│ 287 │ 319 │ 343 │ 375 │ 399 │ 431 │ 455 │ 487 │ 799 │ 831 │ 855 │ 887 │ 911 │ 943 │ 967 │  999 │
└─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴──────┘
    """,
    ],
    [
        CanonicalSharedLayout(
            major_kind="K", swizzle_mode=Tcgen05SwizzleMode.NO_SWIZZLE, SBO=32, LBO=64, m=2, k=4, T=4
        ),
        """
┌────┬────┬────┬────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┐
│  0 │  1 │  2 │  3 │  64 │  65 │  66 │  67 │ 128 │ 129 │ 130 │ 131 │ 192 │ 193 │ 194 │ 195 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  4 │  5 │  6 │  7 │  68 │  69 │  70 │  71 │ 132 │ 133 │ 134 │ 135 │ 196 │ 197 │ 198 │ 199 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  8 │  9 │ 10 │ 11 │  72 │  73 │  74 │  75 │ 136 │ 137 │ 138 │ 139 │ 200 │ 201 │ 202 │ 203 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 12 │ 13 │ 14 │ 15 │  76 │  77 │  78 │  79 │ 140 │ 141 │ 142 │ 143 │ 204 │ 205 │ 206 │ 207 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 16 │ 17 │ 18 │ 19 │  80 │  81 │  82 │  83 │ 144 │ 145 │ 146 │ 147 │ 208 │ 209 │ 210 │ 211 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 20 │ 21 │ 22 │ 23 │  84 │  85 │  86 │  87 │ 148 │ 149 │ 150 │ 151 │ 212 │ 213 │ 214 │ 215 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 24 │ 25 │ 26 │ 27 │  88 │  89 │  90 │  91 │ 152 │ 153 │ 154 │ 155 │ 216 │ 217 │ 218 │ 219 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 28 │ 29 │ 30 │ 31 │  92 │  93 │  94 │  95 │ 156 │ 157 │ 158 │ 159 │ 220 │ 221 │ 222 │ 223 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 32 │ 33 │ 34 │ 35 │  96 │  97 │  98 │  99 │ 160 │ 161 │ 162 │ 163 │ 224 │ 225 │ 226 │ 227 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 36 │ 37 │ 38 │ 39 │ 100 │ 101 │ 102 │ 103 │ 164 │ 165 │ 166 │ 167 │ 228 │ 229 │ 230 │ 231 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 40 │ 41 │ 42 │ 43 │ 104 │ 105 │ 106 │ 107 │ 168 │ 169 │ 170 │ 171 │ 232 │ 233 │ 234 │ 235 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 44 │ 45 │ 46 │ 47 │ 108 │ 109 │ 110 │ 111 │ 172 │ 173 │ 174 │ 175 │ 236 │ 237 │ 238 │ 239 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 48 │ 49 │ 50 │ 51 │ 112 │ 113 │ 114 │ 115 │ 176 │ 177 │ 178 │ 179 │ 240 │ 241 │ 242 │ 243 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 52 │ 53 │ 54 │ 55 │ 116 │ 117 │ 118 │ 119 │ 180 │ 181 │ 182 │ 183 │ 244 │ 245 │ 246 │ 247 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 56 │ 57 │ 58 │ 59 │ 120 │ 121 │ 122 │ 123 │ 184 │ 185 │ 186 │ 187 │ 248 │ 249 │ 250 │ 251 │
├────┼────┼────┼────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 60 │ 61 │ 62 │ 63 │ 124 │ 125 │ 126 │ 127 │ 188 │ 189 │ 190 │ 191 │ 252 │ 253 │ 254 │ 255 │
└────┴────┴────┴────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┘
""",
    ],
    [
        CanonicalSharedLayout(
            major_kind="K", swizzle_mode=Tcgen05SwizzleMode.B32_SWIZZLE, SBO=64, LBO=128, m=2, k=2, T=4
        ),
        """
┌─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┐
│   0 │   1 │   2 │   3 │   4 │   5 │   6 │   7 │ 128 │ 129 │ 130 │ 131 │ 132 │ 133 │ 134 │ 135 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│   8 │   9 │  10 │  11 │  12 │  13 │  14 │  15 │ 136 │ 137 │ 138 │ 139 │ 140 │ 141 │ 142 │ 143 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  16 │  17 │  18 │  19 │  20 │  21 │  22 │  23 │ 144 │ 145 │ 146 │ 147 │ 148 │ 149 │ 150 │ 151 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  24 │  25 │  26 │  27 │  28 │  29 │  30 │  31 │ 152 │ 153 │ 154 │ 155 │ 156 │ 157 │ 158 │ 159 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  36 │  37 │  38 │  39 │  32 │  33 │  34 │  35 │ 164 │ 165 │ 166 │ 167 │ 160 │ 161 │ 162 │ 163 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  44 │  45 │  46 │  47 │  40 │  41 │  42 │  43 │ 172 │ 173 │ 174 │ 175 │ 168 │ 169 │ 170 │ 171 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  52 │  53 │  54 │  55 │  48 │  49 │  50 │  51 │ 180 │ 181 │ 182 │ 183 │ 176 │ 177 │ 178 │ 179 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  60 │  61 │  62 │  63 │  56 │  57 │  58 │  59 │ 188 │ 189 │ 190 │ 191 │ 184 │ 185 │ 186 │ 187 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  64 │  65 │  66 │  67 │  68 │  69 │  70 │  71 │ 192 │ 193 │ 194 │ 195 │ 196 │ 197 │ 198 │ 199 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  72 │  73 │  74 │  75 │  76 │  77 │  78 │  79 │ 200 │ 201 │ 202 │ 203 │ 204 │ 205 │ 206 │ 207 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  80 │  81 │  82 │  83 │  84 │  85 │  86 │  87 │ 208 │ 209 │ 210 │ 211 │ 212 │ 213 │ 214 │ 215 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│  88 │  89 │  90 │  91 │  92 │  93 │  94 │  95 │ 216 │ 217 │ 218 │ 219 │ 220 │ 221 │ 222 │ 223 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 100 │ 101 │ 102 │ 103 │  96 │  97 │  98 │  99 │ 228 │ 229 │ 230 │ 231 │ 224 │ 225 │ 226 │ 227 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 108 │ 109 │ 110 │ 111 │ 104 │ 105 │ 106 │ 107 │ 236 │ 237 │ 238 │ 239 │ 232 │ 233 │ 234 │ 235 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 116 │ 117 │ 118 │ 119 │ 112 │ 113 │ 114 │ 115 │ 244 │ 245 │ 246 │ 247 │ 240 │ 241 │ 242 │ 243 │
├─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 124 │ 125 │ 126 │ 127 │ 120 │ 121 │ 122 │ 123 │ 252 │ 253 │ 254 │ 255 │ 248 │ 249 │ 250 │ 251 │
└─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┘
    """,
    ],
]


@pytest.mark.parametrize("canonical, expected", canonical2expected)
def test_shared_layout_from_canonical(canonical, expected):
    layout = get_shared_layout_from_canonical(canonical)
    actual = layout.visualize()
    # remove the first line in the actual
    actual = "\n".join(actual.split("\n")[1:])
    expected = expected.strip()

    if actual != expected:
        assert False, canonical


@pytest.mark.parametrize(
    "canonical",
    [
        CanonicalSharedLayout(
            major_kind="MN", swizzle_mode=Tcgen05SwizzleMode.NO_SWIZZLE, SBO=64, LBO=128, m=2, k=2, T=8
        ),
        CanonicalSharedLayout(
            major_kind="MN", swizzle_mode=Tcgen05SwizzleMode.B32_SWIZZLE, SBO=256, LBO=128, m=2, k=2, T=8
        ),
        CanonicalSharedLayout(
            major_kind="MN", swizzle_mode=Tcgen05SwizzleMode.B64_SWIZZLE, SBO=512, LBO=256, m=2, k=2, T=8
        ),
        CanonicalSharedLayout(
            major_kind="K", swizzle_mode=Tcgen05SwizzleMode.NO_SWIZZLE, SBO=32, LBO=64, m=2, k=4, T=4
        ),
        CanonicalSharedLayout(
            major_kind="K", swizzle_mode=Tcgen05SwizzleMode.B32_SWIZZLE, SBO=64, LBO=128, m=2, k=2, T=4
        ),
    ],
)
def test_canonicalize_shared_layout(canonical):
    t_to_dtype = {
        8: float16,
        4: float32,
    }
    dtype = t_to_dtype[canonical.T]
    layout = get_shared_layout_from_canonical(canonical)
    recovered_canonical = canonicalize_shared_layout(layout, dtype)
    assert recovered_canonical is not None
    assert recovered_canonical == canonical, f"{recovered_canonical} != {canonical}"


if __name__ == "__main__":
    pytest.main([__file__])
